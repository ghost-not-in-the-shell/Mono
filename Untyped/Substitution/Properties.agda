module Mono.Untyped.Substitution.Properties where
open import Mono.Prelude
open import Mono.Untyped.PreTerm
open import Mono.Untyped.Weakening
open import Mono.Untyped.Weakening.Properties
open import Mono.Untyped.Substitution

â—‘â—‘-assoc : âˆ€ {ğ”© ğ”ª ğ”« ğ”¬} (Ïâ‚ : Sub ğ”« ğ”¬) (ğ“Œâ‚‚ : Ren ğ”ª ğ”«) (ğ“Œâ‚ƒ : Ren ğ”© ğ”ª)
  â†’ (Ïâ‚ â—‘ ğ“Œâ‚‚) â—‘ ğ“Œâ‚ƒ â‰¡ Ïâ‚ â—‘ (ğ“Œâ‚‚ âˆ™ ğ“Œâ‚ƒ)
â—‘â—‘-assoc Â·        ğ“Œâ‚‚ ğ“Œâ‚ƒ = refl
â—‘â—‘-assoc (Ïâ‚ , t) ğ“Œâ‚‚ ğ“Œâ‚ƒ = _,_ âŸ¨$âŸ© â—‘â—‘-assoc Ïâ‚ ğ“Œâ‚‚ ğ“Œâ‚ƒ âŸ¨*âŸ© sym (renâŠ¢â€¿âˆ™ ğ“Œâ‚‚ ğ“Œâ‚ƒ t)

â—â—‘-assoc : âˆ€ {ğ”© ğ”ª ğ”« ğ”¬} (ğ“Œâ‚ : Ren ğ”« ğ”¬) (Ïâ‚‚ : Sub ğ”ª ğ”«) (ğ“Œâ‚ƒ : Ren ğ”© ğ”ª)
  â†’ (ğ“Œâ‚ â— Ïâ‚‚) â—‘ ğ“Œâ‚ƒ â‰¡ ğ“Œâ‚ â— (Ïâ‚‚ â—‘ ğ“Œâ‚ƒ)
â—â—‘-assoc  done     Â·        ğ“Œâ‚ƒ = refl
â—â—‘-assoc (skip ğ“Œâ‚) (Ïâ‚‚ , t) ğ“Œâ‚ƒ = â—â—‘-assoc ğ“Œâ‚ Ïâ‚‚ ğ“Œâ‚ƒ
â—â—‘-assoc (keep ğ“Œâ‚) (Ïâ‚‚ , t) ğ“Œâ‚ƒ = _, _ âŸ¨$âŸ© â—â—‘-assoc ğ“Œâ‚ Ïâ‚‚ ğ“Œâ‚ƒ

â—-unitË¡ : âˆ€ {ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) â†’ id â— Ï â‰¡ Ï
â—-unitË¡ Â·       = refl
â—-unitË¡ (Ï , t) = _, _ âŸ¨$âŸ© â—-unitË¡ Ï

â—‘-unitË¡ : âˆ€ {ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) â†’ id â—‘ ğ“Œ â‰¡ âŒœ ğ“Œ âŒ
â—‘-unitË¡  done    = refl
â—‘-unitË¡ (skip ğ“Œ) = begin
  id â—‘ skip ğ“Œ         â†‘âŸ¨ (id â—‘_) âˆ˜ skip âŸ¨$âŸ© âˆ™-unitÊ³ ğ“Œ âŸ©
  id â—‘ skip (ğ“Œ âˆ™ id)  â†“âŸ¨ refl âŸ©
  id â—‘ (ğ“Œ âˆ™ â†‘)        â†‘âŸ¨ â—‘â—‘-assoc id ğ“Œ â†‘ âŸ©
  (id â—‘ ğ“Œ) â—‘ â†‘        â†“âŸ¨ _â—‘ _ âŸ¨$âŸ© â—‘-unitË¡ ğ“Œ âŸ©
  âŒœ ğ“Œ âŒ â—‘ â†‘           âˆ
â—‘-unitË¡ (keep ğ“Œ) = _, _ âŸ¨$âŸ© (begin
  (id â—‘ â†‘) â—‘ keep ğ“Œ   â†“âŸ¨ â—‘â—‘-assoc id â†‘ (keep ğ“Œ) âŸ©
  id â—‘ (â†‘ âˆ™ keep ğ“Œ)   â†“âŸ¨ refl âŸ©
  id â—‘ skip (id âˆ™ ğ“Œ)  â†“âŸ¨ (id â—‘_) âˆ˜ skip âŸ¨$âŸ© âˆ™-unitË¡ ğ“Œ âŸ©
  id â—‘ skip ğ“Œ         â†“âŸ¨ â—‘-unitË¡ (skip ğ“Œ) âŸ©
  âŒœ ğ“Œ âŒ â—‘ â†‘           âˆ)

â—-unitÊ³ : âˆ€ {ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) â†’ ğ“Œ â— id â‰¡ âŒœ ğ“Œ âŒ
â—-unitÊ³  done    = refl
â—-unitÊ³ (skip ğ“Œ) = begin
  ğ“Œ â— (id â—‘ â†‘)  â†‘âŸ¨ â—â—‘-assoc ğ“Œ id â†‘ âŸ©
  (ğ“Œ â— id) â—‘ â†‘  â†“âŸ¨ _â—‘ â†‘ âŸ¨$âŸ© â—-unitÊ³ ğ“Œ âŸ©
  âŒœ ğ“Œ âŒ â—‘ â†‘     âˆ
â—-unitÊ³ (keep ğ“Œ) = _, _ âŸ¨$âŸ© â—-unitÊ³ (skip ğ“Œ)

subâˆ‹-â— : âˆ€ {ğ”© ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) (Ï : Sub ğ”© ğ”ª) (x : Var ğ”«)
  â†’ subâˆ‹ (ğ“Œ â— Ï) x â‰¡ subâˆ‹ Ï (renâˆ‹ ğ“Œ x)
subâˆ‹-â—  done    Â·       ()
subâˆ‹-â— (skip ğ“Œ) (Ï , t) x       = subâˆ‹-â— ğ“Œ Ï x
subâˆ‹-â— (keep ğ“Œ) (Ï , t) zero    = refl
subâˆ‹-â— (keep ğ“Œ) (Ï , t) (suc x) = subâˆ‹-â— ğ“Œ Ï x

âŒœkeepâŒâ— : âˆ€ {ğ”© ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) (Ï : Sub ğ”© ğ”ª)
  â†’ âŒœkeepâŒ (ğ“Œ â— Ï) â‰¡ keep ğ“Œ â— âŒœkeepâŒ Ï
âŒœkeepâŒâ— ğ“Œ Ï = _, _ âŸ¨$âŸ© â—â—‘-assoc ğ“Œ Ï â†‘

subâŠ¢â€¿âŒœkeepâŒâ— : âˆ€ {ğ”© ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) (Ï : Sub ğ”© ğ”ª) (t : Tm (suc ğ”«))
  â†’ subâŠ¢ (âŒœkeepâŒ (ğ“Œ â— Ï)) t â‰¡ subâŠ¢ (keep ğ“Œ â— âŒœkeepâŒ Ï) t
subâŠ¢â€¿âŒœkeepâŒâ— ğ“Œ Ï t = (Î» Ï â†’ subâŠ¢ Ï t) âŸ¨$âŸ© âŒœkeepâŒâ— ğ“Œ Ï

subâŠ¢â€¿â— : âˆ€ {ğ”© ğ”ª ğ”«} (ğ“Œ : Ren ğ”ª ğ”«) (Ï : Sub ğ”© ğ”ª) (t : Tm ğ”«)
  â†’ subâŠ¢ (ğ“Œ â— Ï) t â‰¡ subâŠ¢ Ï (renâŠ¢ ğ“Œ t)
subâŠ¢â€¿â— ğ“Œ Ï (U)       = refl
subâŠ¢â€¿â— ğ“Œ Ï (Pi A B)  = Pi âŸ¨$âŸ© subâŠ¢â€¿â— ğ“Œ Ï A
                          âŸ¨*âŸ© (subâŠ¢â€¿âŒœkeepâŒâ— ğ“Œ Ï B â‹® subâŠ¢â€¿â— (keep ğ“Œ) (âŒœkeepâŒ Ï) B)
subâŠ¢â€¿â— ğ“Œ Ï (T)       = refl
subâŠ¢â€¿â— ğ“Œ Ï (var x)   = subâˆ‹-â— ğ“Œ Ï x
subâŠ¢â€¿â— ğ“Œ Ï (lam t)   = lam âŸ¨$âŸ© (subâŠ¢â€¿âŒœkeepâŒâ— ğ“Œ Ï t â‹® subâŠ¢â€¿â— (keep ğ“Œ) (âŒœkeepâŒ Ï) t )
subâŠ¢â€¿â— ğ“Œ Ï (app t u) = app âŸ¨$âŸ© subâŠ¢â€¿â— ğ“Œ Ï t âŸ¨*âŸ© subâŠ¢â€¿â— ğ“Œ Ï u
subâŠ¢â€¿â— ğ“Œ Ï (tt)      = refl

subâˆ‹-â—‘ : âˆ€ {ğ”© ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) (ğ“Œ : Ren ğ”© ğ”ª) (x : Var ğ”«)
  â†’ subâˆ‹ (Ï â—‘ ğ“Œ) x â‰¡ renâŠ¢ ğ“Œ (subâˆ‹ Ï x)
subâˆ‹-â—‘ Â·       ğ“Œ ()
subâˆ‹-â—‘ (Ï , t) ğ“Œ zero    = refl
subâˆ‹-â—‘ (Ï , t) ğ“Œ (suc x) = subâˆ‹-â—‘ Ï ğ“Œ x

âŒœkeepâŒâ—‘ : âˆ€ {ğ”© ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) (ğ“Œ : Ren ğ”© ğ”ª)
  â†’ âŒœkeepâŒ (Ï â—‘ ğ“Œ) â‰¡ âŒœkeepâŒ Ï â—‘ keep ğ“Œ
âŒœkeepâŒâ—‘ Ï ğ“Œ = _, _ âŸ¨$âŸ© (begin
  (Ï â—‘ ğ“Œ) â—‘ â†‘         â†“âŸ¨ â—‘â—‘-assoc Ï ğ“Œ â†‘ âŸ©
  Ï â—‘ (ğ“Œ âˆ™ â†‘)         â†“âŸ¨ (Ï â—‘_) âˆ˜ skip âŸ¨$âŸ© (âˆ™-unitÊ³ ğ“Œ â‹® sym (âˆ™-unitË¡ ğ“Œ)) âŸ©
  Ï â—‘ (â†‘ âˆ™ keep ğ“Œ)    â†‘âŸ¨ â—‘â—‘-assoc Ï â†‘ (keep ğ“Œ) âŸ©
  (Ï â—‘ â†‘) â—‘ (keep ğ“Œ)  âˆ)

subâŠ¢â€¿âŒœkeepâŒâ—‘ : âˆ€ {ğ”© ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) (ğ“Œ : Ren ğ”© ğ”ª) (t : Tm (suc ğ”«))
  â†’ subâŠ¢ (âŒœkeepâŒ (Ï â—‘ ğ“Œ)) t â‰¡ subâŠ¢ (âŒœkeepâŒ Ï â—‘ keep ğ“Œ) t
subâŠ¢â€¿âŒœkeepâŒâ—‘ Ï ğ“Œ t = (Î» Ï â†’ subâŠ¢ Ï t) âŸ¨$âŸ© âŒœkeepâŒâ—‘ Ï ğ“Œ

subâŠ¢â€¿â—‘ : âˆ€ {ğ”© ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) (ğ“Œ : Ren ğ”© ğ”ª) (t : Tm ğ”«)
  â†’ subâŠ¢ (Ï â—‘ ğ“Œ) t â‰¡ renâŠ¢ ğ“Œ (subâŠ¢ Ï t)
subâŠ¢â€¿â—‘ Ï ğ“Œ (U)       = refl
subâŠ¢â€¿â—‘ Ï ğ“Œ (Pi A B)  = Pi âŸ¨$âŸ© subâŠ¢â€¿â—‘ Ï ğ“Œ A
                          âŸ¨*âŸ© (subâŠ¢â€¿âŒœkeepâŒâ—‘ Ï ğ“Œ B â‹® subâŠ¢â€¿â—‘ (âŒœkeepâŒ Ï) (keep ğ“Œ) B)
subâŠ¢â€¿â—‘ Ï ğ“Œ (T)       = refl
subâŠ¢â€¿â—‘ Ï ğ“Œ (var x)   = subâˆ‹-â—‘ Ï ğ“Œ x
subâŠ¢â€¿â—‘ Ï ğ“Œ (lam t)   = lam âŸ¨$âŸ© (subâŠ¢â€¿âŒœkeepâŒâ—‘ Ï ğ“Œ t â‹® subâŠ¢â€¿â—‘ (âŒœkeepâŒ Ï) (keep ğ“Œ) t)
subâŠ¢â€¿â—‘ Ï ğ“Œ (app t u) = app âŸ¨$âŸ© subâŠ¢â€¿â—‘ Ï ğ“Œ t âŸ¨*âŸ© subâŠ¢â€¿â—‘ Ï ğ“Œ u
subâŠ¢â€¿â—‘ Ï ğ“Œ (tt)      = refl

â—‘âˆ˜-assoc : âˆ€ {ğ”© ğ”ª ğ”« ğ”¬} (Ïâ‚ : Sub ğ”« ğ”¬) (ğ“Œâ‚‚ : Ren ğ”ª ğ”«) (Ïâ‚ƒ :  Sub ğ”© ğ”ª)
  â†’ (Ïâ‚ â—‘ ğ“Œâ‚‚) âˆ˜ Ïâ‚ƒ â‰¡ Ïâ‚ âˆ˜ (ğ“Œâ‚‚ â— Ïâ‚ƒ)
â—‘âˆ˜-assoc Â·        ğ“Œâ‚‚ Ïâ‚ƒ = refl
â—‘âˆ˜-assoc (Ïâ‚ , t) ğ“Œâ‚‚ Ïâ‚ƒ = _,_ âŸ¨$âŸ© â—‘âˆ˜-assoc Ïâ‚ ğ“Œâ‚‚ Ïâ‚ƒ âŸ¨*âŸ© sym (subâŠ¢â€¿â— ğ“Œâ‚‚ Ïâ‚ƒ t)

âˆ˜â—‘-assoc : âˆ€ {ğ”© ğ”ª ğ”« ğ”¬} (Ïâ‚ : Sub ğ”« ğ”¬) (Ïâ‚‚ : Sub ğ”ª ğ”«) (ğ“Œâ‚ƒ : Ren ğ”© ğ”ª)
  â†’ (Ïâ‚ âˆ˜ Ïâ‚‚) â—‘ ğ“Œâ‚ƒ â‰¡ Ïâ‚ âˆ˜ (Ïâ‚‚ â—‘ ğ“Œâ‚ƒ)
âˆ˜â—‘-assoc Â·        Ïâ‚‚ ğ“Œâ‚ƒ = refl
âˆ˜â—‘-assoc (Ïâ‚ , t) Ïâ‚‚ ğ“Œâ‚ƒ = _,_ âŸ¨$âŸ© âˆ˜â—‘-assoc Ïâ‚ Ïâ‚‚ ğ“Œâ‚ƒ âŸ¨*âŸ© sym (subâŠ¢â€¿â—‘ Ïâ‚‚ ğ“Œâ‚ƒ t)

subâˆ‹-id : âˆ€ {ğ”«} (x : Var ğ”«) â†’ subâˆ‹ id x â‰¡ var x
subâˆ‹-id zero    = refl
subâˆ‹-id (suc x) = begin
  subâˆ‹ (id â—‘ â†‘) x     â†“âŸ¨ subâˆ‹-â—‘ id â†‘ x âŸ©
  renâŠ¢ â†‘ (subâˆ‹ id x)  â†“âŸ¨ renâŠ¢ â†‘ âŸ¨$âŸ© subâˆ‹-id x âŸ©
  renâŠ¢ â†‘ (var x)      â†“âŸ¨ var âˆ˜ suc âŸ¨$âŸ© renâˆ‹-id x âŸ©
  var (suc x)         âˆ

subâŠ¢â€¿id : âˆ€ {ğ”«} (t : Tm ğ”«) â†’ subâŠ¢ id t â‰¡ t
subâŠ¢â€¿id (U)       = refl
subâŠ¢â€¿id (Pi A B)  = Pi âŸ¨$âŸ© subâŠ¢â€¿id A âŸ¨*âŸ© subâŠ¢â€¿id B
subâŠ¢â€¿id (T)       = refl
subâŠ¢â€¿id (var x)   = subâˆ‹-id x
subâŠ¢â€¿id (lam t)   = lam âŸ¨$âŸ© subâŠ¢â€¿id t
subâŠ¢â€¿id (app t u) = app âŸ¨$âŸ© subâŠ¢â€¿id t âŸ¨*âŸ© subâŠ¢â€¿id u
subâŠ¢â€¿id (tt)      = refl

subâˆ‹-âˆ˜ : âˆ€ {ğ”© ğ”ª ğ”«} (Ïâ‚ : Sub ğ”ª ğ”«) (Ïâ‚‚ : Sub ğ”© ğ”ª) (x : Var ğ”«)
  â†’ subâˆ‹ (Ïâ‚ âˆ˜ Ïâ‚‚) x â‰¡ subâŠ¢ Ïâ‚‚ (subâˆ‹ Ïâ‚ x)
subâˆ‹-âˆ˜ Â·        Ïâ‚‚ ()
subâˆ‹-âˆ˜ (Ïâ‚ , t) Ïâ‚‚ zero    = refl
subâˆ‹-âˆ˜ (Ïâ‚ , t) Ïâ‚‚ (suc x) = subâˆ‹-âˆ˜ Ïâ‚ Ïâ‚‚ x

âŒœkeepâŒâˆ˜ : âˆ€ {ğ”© ğ”ª ğ”«} (Ïâ‚ : Sub ğ”ª ğ”«) (Ïâ‚‚ : Sub ğ”© ğ”ª)
  â†’ âŒœkeepâŒ (Ïâ‚ âˆ˜ Ïâ‚‚) â‰¡ âŒœkeepâŒ Ïâ‚ âˆ˜ âŒœkeepâŒ Ïâ‚‚
âŒœkeepâŒâˆ˜ Ïâ‚ Ïâ‚‚ = _, _ âŸ¨$âŸ© (begin
  (Ïâ‚ âˆ˜ Ïâ‚‚) â—‘ â†‘                   â†“âŸ¨ âˆ˜â—‘-assoc Ïâ‚ Ïâ‚‚ â†‘ âŸ©
  Ïâ‚ âˆ˜ (Ïâ‚‚ â—‘ â†‘)                   â†‘âŸ¨ Ïâ‚ âˆ˜_ âŸ¨$âŸ© â—-unitË¡ (Ïâ‚‚ â—‘ â†‘) âŸ©
  Ïâ‚ âˆ˜ (id â— (Ïâ‚‚ â—‘ â†‘))            â†“âŸ¨ refl âŸ©
  Ïâ‚ âˆ˜ (â†‘ â— (Ïâ‚‚ â—‘ â†‘ , var zero))  â†‘âŸ¨ â—‘âˆ˜-assoc Ïâ‚ â†‘ _ âŸ©
  (Ïâ‚ â—‘ â†‘) âˆ˜ (Ïâ‚‚ â—‘ â†‘ , var zero)  âˆ)

subâŠ¢â€¿âŒœkeepâŒâˆ˜ : âˆ€ {ğ”© ğ”ª ğ”«} (Ïâ‚ : Sub ğ”ª ğ”«) (Ïâ‚‚ : Sub ğ”© ğ”ª) (t : Tm (suc ğ”«))
  â†’ subâŠ¢ (âŒœkeepâŒ (Ïâ‚ âˆ˜ Ïâ‚‚)) t â‰¡ subâŠ¢ (âŒœkeepâŒ Ïâ‚ âˆ˜ âŒœkeepâŒ Ïâ‚‚) t
subâŠ¢â€¿âŒœkeepâŒâˆ˜ Ïâ‚ Ïâ‚‚ t = (Î» Ï â†’ subâŠ¢ Ï t) âŸ¨$âŸ© âŒœkeepâŒâˆ˜ Ïâ‚ Ïâ‚‚

subâŠ¢â€¿âˆ˜ : âˆ€ {ğ”© ğ”ª ğ”«} (Ïâ‚ : Sub ğ”ª ğ”«) (Ïâ‚‚ : Sub ğ”© ğ”ª) (t : Tm ğ”«)
  â†’ subâŠ¢ (Ïâ‚ âˆ˜ Ïâ‚‚) t â‰¡ subâŠ¢ Ïâ‚‚ (subâŠ¢ Ïâ‚ t)
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (U)       = refl
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (Pi A B)  = Pi âŸ¨$âŸ© subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ A
                            âŸ¨*âŸ© (subâŠ¢â€¿âŒœkeepâŒâˆ˜ Ïâ‚ Ïâ‚‚ B â‹® subâŠ¢â€¿âˆ˜ (âŒœkeepâŒ Ïâ‚) (âŒœkeepâŒ Ïâ‚‚) B)
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (T)       = refl
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (var x)   = subâˆ‹-âˆ˜ Ïâ‚ Ïâ‚‚ x
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (lam t)   = lam âŸ¨$âŸ© (subâŠ¢â€¿âŒœkeepâŒâˆ˜ Ïâ‚ Ïâ‚‚ t â‹® subâŠ¢â€¿âˆ˜ (âŒœkeepâŒ Ïâ‚) (âŒœkeepâŒ Ïâ‚‚) t)
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (app t u) = app âŸ¨$âŸ© subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ t âŸ¨*âŸ© subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ u
subâŠ¢â€¿âˆ˜ Ïâ‚ Ïâ‚‚ (tt)      = refl

âˆ˜-unitË¡ : âˆ€ {ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) â†’ id âˆ˜ Ï â‰¡ Ï
âˆ˜-unitË¡ Â·       = refl
âˆ˜-unitË¡ (Ï , t) = _, _ âŸ¨$âŸ© (begin
  (id â—‘ â†‘) âˆ˜ (Ï , t)  â†“âŸ¨ â—‘âˆ˜-assoc id â†‘ _ âŸ©
  id âˆ˜ (â†‘ â— (Ï , t))  â†“âŸ¨ refl âŸ©
  id âˆ˜ (id â— Ï)       â†“âŸ¨ id âˆ˜_ âŸ¨$âŸ© â—-unitË¡ Ï âŸ©
  id âˆ˜ Ï              â†“âŸ¨ âˆ˜-unitË¡ Ï âŸ©
  Ï                   âˆ)

âˆ˜-unitÊ³ : âˆ€ {ğ”ª ğ”«} (Ï : Sub ğ”ª ğ”«) â†’ Ï âˆ˜ id â‰¡ Ï
âˆ˜-unitÊ³ Â·       = refl
âˆ˜-unitÊ³ (Ï , t) = _,_ âŸ¨$âŸ© âˆ˜-unitÊ³ Ï âŸ¨*âŸ© subâŠ¢â€¿id t

âˆ˜-assoc : âˆ€ {ğ”© ğ”ª ğ”« ğ”¬} (Ïâ‚ : Sub ğ”« ğ”¬) (Ïâ‚‚ : Sub ğ”ª ğ”«) (Ïâ‚ƒ : Sub ğ”© ğ”ª)
  â†’ (Ïâ‚ âˆ˜ Ïâ‚‚) âˆ˜ Ïâ‚ƒ â‰¡ Ïâ‚ âˆ˜ (Ïâ‚‚ âˆ˜ Ïâ‚ƒ)
âˆ˜-assoc Â·        Ïâ‚‚ Ïâ‚ƒ = refl
âˆ˜-assoc (Ïâ‚ , t) Ïâ‚‚ Ïâ‚ƒ = _,_ âŸ¨$âŸ© âˆ˜-assoc Ïâ‚ Ïâ‚‚ Ïâ‚ƒ âŸ¨*âŸ© sym (subâŠ¢â€¿âˆ˜ Ïâ‚‚ Ïâ‚ƒ t)

renâŠ¢â€¿subâ‚ : âˆ€ {ğ”ª ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} (t : Tm (suc ğ”«)) {u : Tm ğ”«} â†’ renâŠ¢ ğ“Œ (t [ u ]â‚) â‰¡ renâŠ¢ (keep ğ“Œ) t [ renâŠ¢ ğ“Œ u ]â‚
renâŠ¢â€¿subâ‚ {ğ“Œ = ğ“Œ} t {u} = begin
  renâŠ¢ ğ“Œ (subâŠ¢ (id , u) t)                â†‘âŸ¨ subâŠ¢â€¿â—‘ _ ğ“Œ t âŸ©
  subâŠ¢ ((id , u) â—‘ ğ“Œ) t                   â†“âŸ¨ refl âŸ©
  subâŠ¢ (id â—‘ ğ“Œ , renâŠ¢ ğ“Œ u) t              â†“âŸ¨ (Î» Ï â†’ subâŠ¢ (Ï , renâŠ¢ ğ“Œ u) t) âŸ¨$âŸ© (â—‘-unitË¡ ğ“Œ â‹® sym (â—-unitÊ³ ğ“Œ)) âŸ©
  subâŠ¢ (ğ“Œ â— id , renâŠ¢ ğ“Œ u) t              â†“âŸ¨ refl âŸ©
  subâŠ¢ (keep ğ“Œ â— (id , renâŠ¢ ğ“Œ u)) t       â†“âŸ¨ subâŠ¢â€¿â— (keep ğ“Œ) _ t âŸ©
  subâŠ¢ (id , renâŠ¢ ğ“Œ u) (renâŠ¢ (keep ğ“Œ) t)  âˆ
