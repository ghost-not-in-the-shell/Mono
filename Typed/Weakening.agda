module Mono.Typed.Weakening where
open import Mono.Prelude
open import Mono.Untyped.PreTerm
open import Mono.Untyped.Weakening
open import Mono.Untyped.Weakening.Properties
open import Mono.Untyped.Substitution
open import Mono.Untyped.Substitution.Properties
open import Mono.Typed.Term

infix  4 _âŠ‡_âˆ¶_
infixr 6 _âˆ™Ì…_

data _âŠ‡_âˆ¶_ : âˆ€ {ğ”ª ğ”«} â†’ Con ğ”ª â†’ Ren ğ”ª ğ”« â†’ Con ğ”« â†’ Set where
  ğ••ğ• ğ•Ÿğ•– : Â· âŠ‡ done âˆ¶ Â·

  ğ•¤ğ•œğ•šğ•¡â½_â¾ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”ª}
    â†’ Î”     âŠ¢      A âˆ¶ U
    â†’ Î”     âŠ‡      ğ“Œ âˆ¶ Î“
    â†’ Î” , A âŠ‡ skip ğ“Œ âˆ¶ Î“

  ğ•œğ•–ğ•–ğ•¡ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”«}
    â†’ Î”            âŠ‡      ğ“Œ âˆ¶ Î“
    â†’ Î” , renâŠ¢ ğ“Œ A âŠ‡ keep ğ“Œ âˆ¶ Î“ , A

pattern ğ•¤ğ•œğ•šğ•¡ ğ•¨ = ğ•¤ğ•œğ•šğ•¡â½ _ â¾ ğ•¨

ğ•£ğ•–ğ•Ÿâˆ‹ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”«} {x : Var ğ”«}
  â†’ Î” âŠ‡ ğ“Œ âˆ¶ Î“
  â†’ Î“ âˆ‹ x âˆ¶ A
  â†’ Î” âˆ‹ renâˆ‹ ğ“Œ x âˆ¶ renâŠ¢ ğ“Œ A
ğ•£ğ•–ğ•Ÿâˆ‹ ğ••ğ• ğ•Ÿğ•– ()
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•¤ğ•œğ•šğ•¡ ğ•¨) ğ•©       = ğ•¤ğ•¦ğ•” (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©) âŸ¦ Î” âˆ‹ _ âˆ¶_ âŸ¨$âŸ© renâŠ¢â€¿skip _ _ âŸ«
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•«ğ•–ğ•£ğ•     = ğ•«ğ•–ğ•£ğ•            âŸ¦ Î” âˆ‹ _ âˆ¶_ âŸ¨$âŸ© renâŠ¢â€¿keep _ _ âŸ«
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•œğ•–ğ•–ğ•¡ ğ•¨) (ğ•¤ğ•¦ğ•” ğ•©) = ğ•¤ğ•¦ğ•” (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©) âŸ¦ Î” âˆ‹ _ âˆ¶_ âŸ¨$âŸ© renâŠ¢â€¿keep _ _ âŸ«

mutual
  ğ•£ğ•–ğ•ŸâŠ¢ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A t : Tm ğ”«}
    â†’ Î” âŠ‡        ğ“Œ âˆ¶ Î“
    â†’ Î“ âŠ¢        t âˆ¶ A
    â†’ Î” âŠ¢ renâŠ¢ ğ“Œ t âˆ¶ renâŠ¢ ğ“Œ A
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•Œ)               = ğ•Œ
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (â„¿ ğ”¸ ğ”¹)           = â„¿ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸) (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ”¹)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•‹)               = ğ•‹
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•§ğ•’ğ•£ ğ•©)           = ğ•§ğ•’ğ•£ (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•ğ•’ğ• ğ”¸ ğ•¥)         = ğ•ğ•’ğ• (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸) (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¥)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•’ğ•¡ğ•¡ {B = B} ğ•¥ ğ•¦) = ğ•’ğ•¡ğ•¡ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥) (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¦) âŸ¦ _ âŠ¢ _ âˆ¶_ âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•¥ğ•¥)              = ğ•¥ğ•¥
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•¥ â‰« â„)           = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥ â‰« ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„

  ğ•£ğ•–ğ•Ÿâˆ¼ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A tâ‚ tâ‚‚ : Tm ğ”«}
    â†’ Î” âŠ‡                     ğ“Œ âˆ¶ Î“
    â†’ Î“ âŠ¢        tâ‚ âˆ¼        tâ‚‚ âˆ¶ A
    â†’ Î” âŠ¢ renâŠ¢ ğ“Œ tâ‚ âˆ¼ renâŠ¢ ğ“Œ tâ‚‚ âˆ¶ renâŠ¢ ğ“Œ A
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•£ğ•–ğ•—ğ•  ğ•¥)                = ğ•£ğ•–ğ•—ğ•  (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¤ğ•ªğ•   ğ•¡)                = ğ•¤ğ•ªğ•   (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¥ğ•£ğ•’ğ•Ÿğ•¤ ğ•¡ ğ•¢)              = ğ•¥ğ•£ğ•’ğ•Ÿğ•¤ (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡) (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¢)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•”ğ• ğ•Ÿğ•˜ â„â‚ â„â‚‚)           = â„¿-ğ•”ğ• ğ•Ÿğ•˜ (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„â‚) (ğ•£ğ•–ğ•Ÿâˆ¼ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) â„â‚‚)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•ğ•’ğ•-ğ•”ğ• ğ•Ÿğ•˜ ğ”¸ ğ•¡)           = ğ•ğ•’ğ•-ğ•”ğ• ğ•Ÿğ•˜ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸) (ğ•£ğ•–ğ•Ÿâˆ¼ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¡)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•’ğ•¡ğ•¡-ğ•”ğ• ğ•Ÿğ•˜ {B = B} ğ•¡ ğ•¢)   = ğ•’ğ•¡ğ•¡-ğ•”ğ• ğ•Ÿğ•˜ (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡) (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¢) âŸ¦ _ âŠ¢ _ âˆ¼ _ âˆ¶_ âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•“ğ•–ğ•¥ğ•’ {B = B} {t} ğ•¥ ğ•¦) = â„¿-ğ•“ğ•–ğ•¥ğ•’ (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¥) (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¦) âŸ¦ _ âŠ¢ app _ _ âˆ¼_âˆ¶_ âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ t) âŸ¨*âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•–ğ•¥ğ•’ ğ•¥)                = â„¿-ğ•–ğ•¥ğ•’ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥) âŸ¦ (Î» t â†’ _ âŠ¢ renâŠ¢ _ _ âˆ¼ lam (app t (var zero)) âˆ¶ _) âŸ¨$âŸ© renâŠ¢â€¿keep _ _ âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•‹-ğ•–ğ•¥ğ•’ ğ•¥)                = ğ•‹-ğ•–ğ•¥ğ•’ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¡ â‰« â„)                  = ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡ â‰« ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„

ğ•£ğ•–ğ•Ÿâœ“ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«}
  â†’ Î” âŠ‡ ğ“Œ âˆ¶ Î“
  â†’ Î“ ctx
  â†’ Î” ctx
ğ•£ğ•–ğ•Ÿâœ“ ğ••ğ• ğ•Ÿğ•–          Â·       = Â·
ğ•£ğ•–ğ•Ÿâœ“ (ğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾ ğ•¨) â„¾       = ğ•£ğ•–ğ•Ÿâœ“ ğ•¨ â„¾ , ğ”¸
ğ•£ğ•–ğ•Ÿâœ“ (ğ•œğ•–ğ•–ğ•¡      ğ•¨) (â„¾ , ğ”¸) = ğ•£ğ•–ğ•Ÿâœ“ ğ•¨ â„¾ , ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸

ğ•šğ•• : âˆ€ {ğ”«} {Î“ : Con ğ”«} â†’ Î“ âŠ‡ id âˆ¶ Î“
ğ•šğ•• {Î“ = Â·}     = ğ••ğ• ğ•Ÿğ•–
ğ•šğ•• {Î“ = Î“ , A} = ğ•œğ•–ğ•–ğ•¡ ğ•šğ•• âŸ¦ (Î» B â†’ _ , B âŠ‡ _ âˆ¶ _ , A) âŸ¨$âŸ© renâŠ¢â€¿id A âŸ«

_âˆ™Ì…_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œâ‚ : Ren ğ”ª ğ”«} {ğ“Œâ‚‚ : Ren ğ”© ğ”ª}
  â†’ Î” âŠ‡ ğ“Œâ‚ âˆ¶ Î“
  â†’ Î• âŠ‡ ğ“Œâ‚‚ âˆ¶ Î”
  â†’ Î• âŠ‡ ğ“Œâ‚ âˆ™ ğ“Œâ‚‚ âˆ¶ Î“
ğ•¨â‚           âˆ™Ì… ğ••ğ• ğ•Ÿğ•–         = ğ•¨â‚
ğ•¨â‚           âˆ™Ì… ğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾ ğ•¨â‚‚ = ğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾         (ğ•¨â‚ âˆ™Ì… ğ•¨â‚‚)
ğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾ ğ•¨â‚ âˆ™Ì… ğ•œğ•–ğ•–ğ•¡      ğ•¨â‚‚ = ğ•¤ğ•œğ•šğ•¡â½ ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨â‚‚ ğ”¸ â¾ (ğ•¨â‚ âˆ™Ì… ğ•¨â‚‚)
ğ•œğ•–ğ•–ğ•¡      ğ•¨â‚ âˆ™Ì… ğ•œğ•–ğ•–ğ•¡      ğ•¨â‚‚ = ğ•œğ•–ğ•–ğ•¡              (ğ•¨â‚ âˆ™Ì… ğ•¨â‚‚) âŸ¦ (Î» B â†’ _ , B âŠ‡ _ âˆ¶ _ , _) âŸ¨$âŸ© renâŠ¢â€¿âˆ™ _ _ _ âŸ«

â‡‘â½_â¾ : âˆ€ {ğ”«} {Î“ : Con ğ”«} {A : Tm ğ”«}
  â†’ Î“ âŠ¢ A âˆ¶ U
  â†’ Î“ , A âŠ‡ â†‘ âˆ¶ Î“
â‡‘â½ ğ”¸ â¾ = ğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾ ğ•šğ••

â¦…â‡‘â½â¾â¦†-syntax : âˆ€ {ğ”«} {Î“ : Con ğ”«} {A B t : Tm ğ”«}
  â†’ Î“     âŠ¢     B âˆ¶ U
  â†’ Î“     âŠ¢     t âˆ¶ A
  â†’ Î“ , B âŠ¢ t [â†‘] âˆ¶ A [â†‘]
â¦…â‡‘â½â¾â¦†-syntax ğ”¹ ğ•¥ = ğ•£ğ•–ğ•ŸâŠ¢ â‡‘â½ ğ”¹ â¾ ğ•¥

syntax â¦…â‡‘â½â¾â¦†-syntax ğ”¹ ğ•¥ = ğ•¥ â¦…â‡‘â½ ğ”¹ â¾â¦†
