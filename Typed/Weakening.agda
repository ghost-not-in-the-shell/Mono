module Mono.Typed.Weakening where
open import Mono.Prelude
open import Mono.Untyped.PreTerm
open import Mono.Untyped.Weakening
open import Mono.Untyped.Weakening.Properties
open import Mono.Untyped.Substitution
open import Mono.Untyped.Substitution.Properties
open import Mono.Typed.Term

infix  4 _âŠ‡_âˆ¶_
infixr 6 _âŠ™_

data _âŠ‡_âˆ¶_ : âˆ€ {ğ”ª ğ”«} â†’ Con ğ”ª â†’ Ren ğ”ª ğ”« â†’ Con ğ”« â†’ Set where
  ğ••ğ• ğ•Ÿğ•– : Â· âŠ‡ done âˆ¶ Â·

  ğ•¤ğ•œğ•šğ•¡â½_â¾ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} (A : Tm ğ”ª)
    â†’ Î”     âŠ‡      ğ“Œ âˆ¶ Î“
    â†’ Î” , A âŠ‡ skip ğ“Œ âˆ¶ Î“

  ğ•œğ•–ğ•–ğ•¡â½_â¾ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} (A : Tm ğ”«)
    â†’ Î”            âŠ‡      ğ“Œ âˆ¶ Î“
    â†’ Î” , renâŠ¢ ğ“Œ A âŠ‡ keep ğ“Œ âˆ¶ Î“ , A

pattern ğ•¤ğ•œğ•šğ•¡ ğ•¨ = ğ•¤ğ•œğ•šğ•¡â½ _ â¾ ğ•¨
pattern ğ•œğ•–ğ•–ğ•¡ ğ•¨ = ğ•œğ•–ğ•–ğ•¡â½ _ â¾ ğ•¨

ğ•šğ•• : âˆ€ {ğ”«} {Î“ : Con ğ”«} â†’ Î“ âŠ‡ id âˆ¶ Î“
ğ•šğ•• {Î“ = Â·}     = ğ••ğ• ğ•Ÿğ•–
ğ•šğ•• {Î“ = Î“ , A} = ğ•œğ•–ğ•–ğ•¡ ğ•šğ•• âŸ¦ (Î» B â†’ Î“ , B âŠ‡ keep id âˆ¶ Î“ , A) âŸ¨$âŸ© renâŠ¢â€¿id A âŸ«

_âŠ™_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œâ‚ : Ren ğ”ª ğ”«} {ğ“Œâ‚‚ : Ren ğ”© ğ”ª}
  â†’ Î” âŠ‡      ğ“Œâ‚ âˆ¶ Î“
  â†’ Î• âŠ‡      ğ“Œâ‚‚ âˆ¶ Î”
  â†’ Î• âŠ‡ ğ“Œâ‚ âˆ™ ğ“Œâ‚‚ âˆ¶ Î“
ğ•¨â‚      âŠ™ ğ••ğ• ğ•Ÿğ•–    = ğ•¨â‚
ğ•¨â‚      âŠ™ ğ•¤ğ•œğ•šğ•¡ ğ•¨â‚‚ = ğ•¤ğ•œğ•šğ•¡ (ğ•¨â‚ âŠ™ ğ•¨â‚‚)
ğ•¤ğ•œğ•šğ•¡ ğ•¨â‚ âŠ™ ğ•œğ•–ğ•–ğ•¡ ğ•¨â‚‚ = ğ•¤ğ•œğ•šğ•¡ (ğ•¨â‚ âŠ™ ğ•¨â‚‚)
ğ•œğ•–ğ•–ğ•¡ ğ•¨â‚ âŠ™ ğ•œğ•–ğ•–ğ•¡ ğ•¨â‚‚ = ğ•œğ•–ğ•–ğ•¡ (ğ•¨â‚ âŠ™ ğ•¨â‚‚) âŸ¦ (Î» A â†’ _ , A âŠ‡ _ âˆ¶ _) âŸ¨$âŸ© renâŠ¢â€¿âˆ™ _ _ _ âŸ«

â‡‘ : âˆ€ {ğ”«} {Î“ : Con ğ”«} {A : Tm ğ”«}
  â†’ Î“ , A âŠ‡ â†‘ âˆ¶ Î“
â‡‘ = ğ•¤ğ•œğ•šğ•¡ ğ•šğ••

ğ•£ğ•–ğ•Ÿâˆ‹ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”«} {x : Var ğ”«}
  â†’ Î” âŠ‡        ğ“Œ âˆ¶ Î“
  â†’ Î“ âˆ‹        x âˆ¶ A
  â†’ Î” âˆ‹ renâˆ‹ ğ“Œ x âˆ¶ renâŠ¢ ğ“Œ A
ğ•£ğ•–ğ•Ÿâˆ‹ ğ••ğ• ğ•Ÿğ•– ()
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•¤ğ•œğ•šğ•¡ ğ•¨) ğ•©       = ğ•¤ğ•¦ğ•” (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©) âŸ¦ (Î” âˆ‹ _ âˆ¶_) âŸ¨$âŸ© renâŠ¢â€¿skip âŸ«
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•«ğ•–ğ•£ğ•     = ğ•«ğ•–ğ•£ğ•            âŸ¦ (Î” âˆ‹ _ âˆ¶_) âŸ¨$âŸ© renâŠ¢â€¿keep âŸ«
ğ•£ğ•–ğ•Ÿâˆ‹ {Î” = Î”} (ğ•œğ•–ğ•–ğ•¡ ğ•¨) (ğ•¤ğ•¦ğ•” ğ•©) = ğ•¤ğ•¦ğ•” (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©) âŸ¦ (Î” âˆ‹ _ âˆ¶_) âŸ¨$âŸ© renâŠ¢â€¿keep âŸ«

mutual
  ğ•£ğ•–ğ•ŸâŠ¢ : âˆ€ {ğ”ª} {Î” : Con ğ”ª} {ğ”» : Î” ctx}
           {ğ”«} {Î“ : Con ğ”«} {ğ”¾ : Î“ ctx}
           {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”«} {t : Tm ğ”«}
         â†’ Î” âŠ‡        ğ“Œ âˆ¶ Î“
         â†’ ğ”¾ âŠ¢        t âˆ¶ A
         â†’ ğ”» âŠ¢ renâŠ¢ ğ“Œ t âˆ¶ renâŠ¢ ğ“Œ A
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•Œ)               = ğ•Œ
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (â„¿ ğ”¸ ğ”¹)           = â„¿ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸) (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ”¹)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•‹)               = ğ•‹
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•§ğ•’ğ•£ ğ•©)           = ğ•§ğ•’ğ•£ (ğ•£ğ•–ğ•Ÿâˆ‹ ğ•¨ ğ•©)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•ğ•’ğ• {ğ”¸ = ğ”¸} ğ•¥)   = ğ•ğ•’ğ• {ğ”¸ = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸} (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¥)
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•’ğ•¡ğ•¡ {B = B} ğ•¥ ğ•¦) = ğ•’ğ•¡ğ•¡ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥) (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¦) âŸ¦ (_ âŠ¢ _ âˆ¶_) âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•¥ğ•¥)              = ğ•¥ğ•¥
  ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ (ğ•¥ â‰« â„)           = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥ â‰« ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„

  ğ•£ğ•–ğ•Ÿâˆ¼ : âˆ€ {ğ”ª} {Î” : Con ğ”ª} {ğ”» : Î” ctx}
           {ğ”«} {Î“ : Con ğ”«} {ğ”¾ : Î“ ctx}
           {ğ“Œ : Ren ğ”ª ğ”«} {A : Tm ğ”«} {tâ‚ : Tm ğ”«} {tâ‚‚ : Tm ğ”«}
         â†’ Î” âŠ‡                     ğ“Œ âˆ¶ Î“
         â†’ ğ”¾ âŠ¢        tâ‚ âˆ¼        tâ‚‚ âˆ¶ A
         â†’ ğ”» âŠ¢ renâŠ¢ ğ“Œ tâ‚ âˆ¼ renâŠ¢ ğ“Œ tâ‚‚ âˆ¶ renâŠ¢ ğ“Œ A
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•£ğ•–ğ•—ğ•  ğ•¥)                        = ğ•£ğ•–ğ•—ğ•  (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¤ğ•ªğ•   ğ•¡)                        = ğ•¤ğ•ªğ•   (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¥ğ•£ğ•’ğ•Ÿğ•¤ ğ•¡ ğ•¢)                      = ğ•¥ğ•£ğ•’ğ•Ÿğ•¤ (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡) (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¢)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•”ğ• ğ•Ÿğ•˜ {ğ”¸â‚ = ğ”¸â‚} â„â‚ â„â‚‚)         = â„¿-ğ•”ğ• ğ•Ÿğ•˜ {ğ”¸â‚ = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸â‚} (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„â‚) (ğ•£ğ•–ğ•Ÿâˆ¼ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) â„â‚‚)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•ğ•’ğ•-ğ•”ğ• ğ•Ÿğ•˜ {ğ”¸ = ğ”¸} ğ•¡)             = ğ•ğ•’ğ•-ğ•”ğ• ğ•Ÿğ•˜ {ğ”¸ = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸} (ğ•£ğ•–ğ•Ÿâˆ¼ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¡)
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•’ğ•¡ğ•¡-ğ•”ğ• ğ•Ÿğ•˜ {B = B} ğ•¡ ğ•¢)           = ğ•’ğ•¡ğ•¡-ğ•”ğ• ğ•Ÿğ•˜ (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡) (ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¢) âŸ¦ (_ âŠ¢ _ âˆ¼ _ âˆ¶_) âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•“ğ•–ğ•¥ğ•’ {B = B} {t} {ğ”¸ = ğ”¸} ğ•¥ ğ•¦) = â„¿-ğ•“ğ•–ğ•¥ğ•’ {ğ”¸ = ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ”¸} (ğ•£ğ•–ğ•ŸâŠ¢ (ğ•œğ•–ğ•–ğ•¡ ğ•¨) ğ•¥) (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¦) âŸ¦ (_ âŠ¢ app _ _ âˆ¼_âˆ¶_) âŸ¨$âŸ© sym (renâŠ¢â€¿subâ‚ t) âŸ¨*âŸ© sym (renâŠ¢â€¿subâ‚ B) âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (â„¿-ğ•–ğ•¥ğ•’ ğ•¥)                        = â„¿-ğ•–ğ•¥ğ•’ (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥) âŸ¦ (Î» t â†’ _ âŠ¢ renâŠ¢ _ _ âˆ¼ lam (app t (var zero)) âˆ¶ _) âŸ¨$âŸ© renâŠ¢â€¿keep âŸ«
  ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ (ğ•¡ â‰« â„)                          = ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ ğ•¡ â‰« ğ•£ğ•–ğ•Ÿâˆ¼ ğ•¨ â„

_âŸ¦â‡‘âŸ§ : âˆ€ {ğ”«} {Î“ : Con ğ”«} {ğ”¾ : Î“ ctx} {A B : Tm ğ”«} {t : Tm ğ”«}
  â†’ {ğ”¹ : ğ”¾     âŠ¢     B âˆ¶ U}
  â†’ (ğ•¥ : ğ”¾     âŠ¢     t âˆ¶ A)
  â†’      ğ”¾ , ğ”¹ âŠ¢ t [â†‘] âˆ¶ A [â†‘]
ğ•¥ âŸ¦â‡‘âŸ§ = ğ•£ğ•–ğ•ŸâŠ¢ â‡‘ ğ•¥
