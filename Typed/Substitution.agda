module Mono.Typed.Substitution where
open import Mono.Prelude
open import Mono.Untyped.PreTerm
open import Mono.Untyped.Weakening
open import Mono.Untyped.Substitution
open import Mono.Untyped.Substitution.Properties
open import Mono.Typed.Term
open import Mono.Typed.Weakening

infix  4 _âŠ¢âƒ—_âˆ¶_
infixl 5 _,_
infixr 6 _âŠš_
infixr 6 _â—Ì…_
infixr 6 _â—‘Ì…_

data _âŠ¢âƒ—_âˆ¶_ {ğ”ª} {Î” : Con ğ”ª} (ğ”» : Î” ctx) : âˆ€ {ğ”«} â†’ Sub ğ”ª ğ”« â†’ Con ğ”« â†’ Set where
  Â· : ğ”» âŠ¢âƒ— Â· âˆ¶ Â·

  _,_ : âˆ€ {ğ”«} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {A : Tm ğ”«} {t : Tm ğ”ª}
    â†’ (â„½ : ğ”» âŠ¢âƒ—     Ï âˆ¶ Î“)
    â†’ (ğ•¥ : ğ”» âŠ¢     t âˆ¶ A [ Ï ])
    â†’      ğ”» âŠ¢âƒ— Ï , t âˆ¶ Î“ , A

_â—Ì…_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {ğ”¼ : Î• ctx} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {Ï : Sub ğ”© ğ”ª}
  â†’ Î” âŠ‡     ğ“Œ âˆ¶ Î“
  â†’ ğ”¼ âŠ¢âƒ—     Ï âˆ¶ Î”
  â†’ ğ”¼ âŠ¢âƒ— ğ“Œ â— Ï âˆ¶ Î“
ğ••ğ• ğ•Ÿğ•–        â—Ì… Â·       = Â·
ğ•¤ğ•œğ•šğ•¡â½ A â¾ ğ•¨ â—Ì… (â„½ , ğ•¥) = ğ•¨ â—Ì… â„½
ğ•œğ•–ğ•–ğ•¡â½ A â¾ ğ•¨ â—Ì… (â„½ , ğ•¥) = ğ•¨ â—Ì… â„½ , (ğ•¥ âŸ¦ (_ âŠ¢ _ âˆ¶_) âŸ¨$âŸ© sym (subâŠ¢â€¿â— _ _ A) âŸ«)

_â—‘Ì…_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {ğ”¼ : Î• ctx} {Î” : Con ğ”ª} {ğ”» : Î” ctx} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {ğ“Œ : Ren ğ”© ğ”ª}
  â†’ ğ”» âŠ¢âƒ— Ï âˆ¶ Î“
  â†’ Î• âŠ‡ ğ“Œ âˆ¶ Î”
  â†’ ğ”¼ âŠ¢âƒ— Ï â—‘ ğ“Œ âˆ¶ Î“
Â·                 â—‘Ì… ğ•¨ = Â·
(_,_ {A = A} â„½ ğ•¥) â—‘Ì… ğ•¨ = â„½ â—‘Ì… ğ•¨ , (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥ âŸ¦ (_ âŠ¢ _ âˆ¶_) âŸ¨$âŸ© sym (subâŠ¢â€¿â—‘ _ _ A) âŸ«)

âŒœğ•¤ğ•œğ•šğ•¡â½_â¾âŒ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {ğ”» : Î” ctx} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {A : Tm ğ”ª}
  â†’ (ğ”¸ : ğ”»     âŠ¢        A âˆ¶ U)
  â†’ (â„½ : ğ”»     âŠ¢âƒ—        Ï âˆ¶ Î“)
  â†’      ğ”» , ğ”¸ âŠ¢âƒ— âŒœskipâŒ Ï âˆ¶ Î“
âŒœğ•¤ğ•œğ•šğ•¡â½ ğ”¸ â¾âŒ â„½ = â„½ â—‘Ì… â‡‘

âŒœğ•¤ğ•œğ•šğ•¡âŒ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {ğ”» : Î” ctx} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {A : Tm ğ”ª}
  â†’ {ğ”¸ : ğ”»     âŠ¢        A âˆ¶ U}
  â†’ (â„½ : ğ”»     âŠ¢âƒ—        Ï âˆ¶ Î“)
  â†’      ğ”» , ğ”¸ âŠ¢âƒ— âŒœskipâŒ Ï âˆ¶ Î“
âŒœğ•¤ğ•œğ•šğ•¡âŒ = âŒœğ•¤ğ•œğ•šğ•¡â½ _ â¾âŒ

{-
âŒœğ•œğ•–ğ•–ğ•¡âŒ : âˆ€ {ğ”ª ğ”«} {Î” : Con ğ”ª} {ğ”» : Î” ctx} {Î“ : Con ğ”«} {ğ”¾ : Î“ ctx} {Ï : Sub ğ”ª ğ”«} {A : Tm ğ”«}
  â†’ {ğ”¸ : ğ”¾ âŠ¢ A âˆ¶ U}
  â†’ (â„½ : ğ”» âŠ¢âƒ—       Ï âˆ¶ Î“)
  â†’      ğ”» , subâŠ¢ Ï A âŠ¢âƒ— âŒœkeepâŒ Ï âˆ¶ Î“ , A
âŒœğ•œğ•–ğ•–ğ•¡âŒ = ?
-}

{-
data _âŠ¢âƒ—_âˆ¶_ {ğ”ª} (Î” : Con ğ”ª) : âˆ€ {ğ”«} â†’ Sub ğ”ª ğ”« â†’ Con ğ”« â†’ Set where
  Â· : Î” âŠ¢âƒ— Â· âˆ¶ Â·

  _,_ : âˆ€ {ğ”«} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {A : Tm ğ”«} {t : Tm ğ”ª}
    â†’ (â„½ : Î” âŠ¢âƒ—     Ï âˆ¶ Î“)
    â†’ {ğ”» : Î” ctx}
    â†’ (ğ•¥ : ğ”» âŠ¢     t âˆ¶ A [ Ï ])
    â†’      Î” âŠ¢âƒ— Ï , t âˆ¶ Î“ , A

_â—Ì…_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {ğ“Œ : Ren ğ”ª ğ”«} {Ï : Sub ğ”© ğ”ª}
  â†’ Î” âŠ‡ ğ“Œ âˆ¶ Î“
  â†’ Î• âŠ¢âƒ— Ï âˆ¶ Î”
  â†’ Î• âŠ¢âƒ— ğ“Œ â— Ï âˆ¶ Î“
ğ••ğ• ğ•Ÿğ•–        â—Ì… Â·       = Â·
ğ•¤ğ•œğ•šğ•¡      ğ•¨ â—Ì… (â„½ , ğ•¥) = ğ•¨ â—Ì… â„½
ğ•œğ•–ğ•–ğ•¡â½ A â¾ ğ•¨ â—Ì… (â„½ , ğ•¥) = ğ•¨ â—Ì… â„½ , (ğ•¥ âŸ¦ (_ âŠ¢ _ âˆ¶_) âŸ¨$âŸ© sym (subâŠ¢â€¿â— _ _ A) âŸ«)

_â—‘Ì…_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {Ï : Sub ğ”ª ğ”«} {ğ“Œ : Ren ğ”© ğ”ª}
  â†’ Î” âŠ¢âƒ— Ï âˆ¶ Î“
  â†’ Î• âŠ‡ ğ“Œ âˆ¶ Î”
  â†’ Î• âŠ¢âƒ— Ï â—‘ ğ“Œ âˆ¶ Î“
Â·       â—‘Ì… ğ•¨ = Â·
(â„½ , ğ•¥) â—‘Ì… ğ•¨ = â„½ â—‘Ì… ğ•¨ , (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥ âŸ¦ {!!} âŸ«)

-}

-- (_,_ {Ï = Ï} {A} â„½ {ğ”»} ğ•¥) â—‘Ì… ğ•¨ = â„½ â—‘Ì… ğ•¨ , (ğ•£ğ•–ğ•ŸâŠ¢ ğ•¨ ğ•¥ âŸ¦ {!(ğ”» âŠ¢ _ âˆ¶_) âŸ¨$âŸ© ?!} âŸ«)

{-
_âŠš_ : âˆ€ {ğ”© ğ”ª ğ”«} {Î• : Con ğ”©} {Î” : Con ğ”ª} {Î“ : Con ğ”«} {Ïâ‚ : Sub ğ”ª ğ”«} {Ïâ‚‚ : Sub ğ”© ğ”ª}
  â†’ Î” âŠ¢âƒ— Ïâ‚ âˆ¶ Î“
  â†’ Î• âŠ¢âƒ— Ïâ‚‚ âˆ¶ Î”
  â†’ Î• âŠ¢âƒ— Ïâ‚ âˆ˜ Ïâ‚‚ âˆ¶ Î“
â„½â‚ âŠš â„½â‚‚ = {!!}
-}

